# A simple action usage
name: Zeta ✦ kernel
on:
  workflow_dispatch:

jobs:
  Build-Kernel:
    strategy:
      fail-fast: false
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
      - name: Zeta ✦ Build
        uses: dabao1955/kernel_build_action@main
        with:
          kernel-url: https://android.googlesource.com/kernel/common
          kernel-dir: common
          kernel-branch: android12-5.10
          config: gki_defconfig
          arch: arm64
          aosp-gcc: false
          aosp-clang: true
          aosp-clang-version: r416183b1
          ksu: true
          ksu-other: true
          ksu-url: https://github.com/KernelSU-Next/KernelSU-Next
          ksu-version: main
          android-version: 12
          disable-lto: true
          # Passing all optimizations as direct make arguments
          extra-make-args: |
            CONFIG_LOCALVERSION="✦-zeta-Missionary-KSUN+"
            CONFIG_PREEMPT=y
            CONFIG_PREEMPTION=y
            CONFIG_PREEMPT_COUNT=y
            CONFIG_HZ_250=y
            CONFIG_HZ=250
            CONFIG_RCU_BOOST=y
            CONFIG_RCU_BOOST_DELAY=500
            CONFIG_TCP_CONG_BBR=y
            CONFIG_DEFAULT_TCP_CONG="bbr"
            CONFIG_ZRAM_STREAMS=y
            CONFIG_ZRAM_DEF_COMP_THREADS=4
            CONFIG_WQ_POWER_EFFICIENT_DEFAULT=y
            CONFIG_SCHED_AUTOGROUP=y
            CONFIG_EROFS_FS_PCPU_KTHREAD=y
            CONFIG_PANIC_TIMEOUT=0
            CONFIG_KPROBES=y
            CONFIG_HAVE_KPROBES=y
            CONFIG_KPROBE_EVENTS=y
          anykernel3: true
